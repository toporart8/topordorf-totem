/**
 * Mythology Logic Core (calculator.js)
 * 
 * Функционал:
 * 1. getSlavicHall(day, month) - Расчет славянского Чертога.
 * 2. getZoroastrianTotem(year, month, day) - Расчет зороастрийского Тотема (32-летний цикл).
 * 3. getZodiac(day, month) - Расчет знака Зодиака.
 * 
 * Автор: Senior JavaScript Developer (Algorithmic Specialist)
 */

// ==========================================
// 1. СЛАВЯНСКИЙ КАЛЕНДАРЬ (СВАРОЖИЙ КРУГ)
// ==========================================

const SLAVIC_HALLS = [
    { name: "Дева", god: "Джива", desc: "Стремление к познанию, независимость, упорство.", start: { d: 27, m: 8 }, end: { d: 20, m: 9 } },
    { name: "Вепрь", god: "Рамхат", desc: "Решительность, справедливость, умение добиваться цели.", start: { d: 20, m: 9 }, end: { d: 11, m: 10 } },
    { name: "Щука", god: "Рожана", desc: "Адаптивность, спокойствие, стремление к гармонии.", start: { d: 11, m: 10 }, end: { d: 3, m: 11 } },
    { name: "Лебедь", god: "Макошь", desc: "Гордость, верность, способность к предвидению.", start: { d: 3, m: 11 }, end: { d: 24, m: 11 } },
    { name: "Змей", god: "Семаргл", desc: "Мудрость, холодный расчет, активность.", start: { d: 24, m: 11 }, end: { d: 16, m: 12 } },
    { name: "Ворон", god: "Коляда", desc: "Добродушие, открытость, любовь к обучению.", start: { d: 16, m: 12 }, end: { d: 7, m: 1 } },
    { name: "Медведь", god: "Сварог", desc: "Сила, стойкость, покровительство.", start: { d: 7, m: 1 }, end: { d: 31, m: 1 } },
    { name: "Бусл", god: "Род", desc: "Спокойствие, семейственность, рассудительность.", start: { d: 31, m: 1 }, end: { d: 24, m: 2 } }, // Бусл (Аист)
    { name: "Волк", god: "Велес", desc: "Храбрость, верность долгу, поиск истины.", start: { d: 24, m: 2 }, end: { d: 22, m: 3 } },
    { name: "Лиса", god: "Марена", desc: "Хитрость, изворотливость, поиск выгоды.", start: { d: 22, m: 3 }, end: { d: 14, m: 4 } },
    { name: "Тур", god: "Крышень", desc: "Трудолюбие, упорство, стойкость.", start: { d: 14, m: 4 }, end: { d: 6, m: 5 } },
    { name: "Лось", god: "Лада", desc: "Открытость, любовь к природе, веселый нрав.", start: { d: 6, m: 5 }, end: { d: 29, m: 5 } },
    { name: "Финист", god: "Вышень", desc: "Энергичность, максимализм, желание действовать.", start: { d: 29, m: 5 }, end: { d: 20, m: 6 } },
    { name: "Конь", god: "Купала", desc: "Жажда жизни, оптимизм, стремительность.", start: { d: 20, m: 6 }, end: { d: 13, m: 7 } },
    { name: "Орел", god: "Перун", desc: "Мощь, покровительство, воинственность.", start: { d: 13, m: 7 }, end: { d: 4, m: 8 } },
    { name: "Рас", god: "Тарх (Даждьбог)", desc: "Доброта, уверенность, рассудительность.", start: { d: 4, m: 8 }, end: { d: 27, m: 8 } }
];

/**
 * Определяет Славянский Чертог по дате рождения.
 * @param {number} day - День рождения (1-31)
 * @param {number} month - Месяц рождения (1-12)
 * @returns {object} { hall, god, description }
 */
export function getSlavicHall(day, month) {
    // Проходим по всем чертогам и ищем попадание
    for (const hall of SLAVIC_HALLS) {
        const { start, end } = hall;

        let isMatch = false;

        // Случай 1: Период внутри одного месяца
        if (start.m === end.m) {
            if (month === start.m && day >= start.d && day < end.d) {
                isMatch = true;
            }
        }
        // Случай 2: Период внутри года, разные месяцы
        else if (start.m < end.m) {
            if ((month === start.m && day >= start.d) ||
                (month === end.m && day < end.d) ||
                (month > start.m && month < end.m)) {
                isMatch = true;
            }
        }
        // Случай 3: Переход через год
        else {
            if ((month === start.m && day >= start.d) ||
                (month === end.m && day < end.d) ||
                (month > start.m) ||
                (month < end.m)) {
                isMatch = true;
            }
        }

        if (isMatch) return formatHall(hall);
    }

    return { hall: "Неизвестно", god: "Неизвестно", description: "Ошибка даты" };
}

function formatHall(hall) {
    return {
        hall: `Чертог ${hall.name}`,
        god: hall.god,
        description: hall.desc
    };
}


// ==========================================
// 2. ЗОРОАСТРИЙСКИЙ ГОРОСКОП (ТОТЕМЫ)
// ==========================================

const ZOROASTRIAN_TOTEMS = [
    { totem: "Олень (Золоторогий)", symbol: "Харизма, гордость, сила духа." }, // 1-й год цикла
    { totem: "Баран (Горный)", symbol: "Упрямство, долг, коллективизм." },     // 2-й год
    { totem: "Мангуст", symbol: "Ловкость, интуиция, борьба со злом." },       // и т.д.
    { totem: "Волк", symbol: "Сила, активность, экстремальность." },
    { totem: "Аист", symbol: "Мир, семья, консерватизм." },
    { totem: "Паук", symbol: "Связи, исцеление, скромность." },
    { totem: "Змея (Уж)", symbol: "Мудрость, мистика, скрытность." },
    { totem: "Бобер", symbol: "Трудолюбие, созидание, мастерство." },
    { totem: "Черепаха", symbol: "Мудрость, осторожность, память." },          // Index 8
    { totem: "Сорока", symbol: "Связь, слово, активность." },                 // Index 9 (1980 по запросу пользователя)
    { totem: "Белка", symbol: "Живость, ум, работоспособность." },
    { totem: "Ворон", symbol: "Независимость, серьезность, пророчество." },
    { totem: "Петух", symbol: "Реформаторство, бесстрашие, активность." },
    { totem: "Бык (Тур)", symbol: "Сила, выносливость, долг." },
    { totem: "Барсук", symbol: "Хозяйственность, скрытность, бережливость." },
    { totem: "Верблюд", symbol: "Аскетизм, выносливость, скепсис." },
    { totem: "Еж", symbol: "Непредсказуемость, свобода, колючесть." },
    { totem: "Лань", symbol: "Грация, артистизм, чуткость." },
    { totem: "Слон", symbol: "Устойчивость, мудрость, традиция." },
    { totem: "Конь (Лошадь)", symbol: "Выносливость, широта души, верность." },
    { totem: "Гепард", symbol: "Скорость, борьба, бесстрашие." },
    { totem: "Павлин", symbol: "Многогранность, творчество, игра." },
    { totem: "Лебедь", symbol: "Высокие идеалы, духовность, верность." },
    { totem: "Рысь (Соловей)", symbol: "Озарение, преображение, бдительность." },
    { totem: "Осел", symbol: "Терпение, мир, упорство." },
    { totem: "Белый Медведь", symbol: "Лидерство, щедрость, игра." },
    { totem: "Орел", symbol: "Власть, государственность, высота." },
    { totem: "Лисица", symbol: "Хитрость, ум, проницательность." },
    { totem: "Дельфин", symbol: "Спасение, тайна, помощь." },
    { totem: "Вепрь", symbol: "Мощь, напор, главенство." },
    { totem: "Сова (Филин)", symbol: "Тайна, ночная жизнь, мудрость." },
    { totem: "Сокол", symbol: "Полет, победа, дисциплина." }
];

/**
 * Определяет Зороастрийский Тотем.
 * 32-летний цикл.
 * Год начинается 21 марта!
 * Базовый год: 1939 (Index 0 = Олень).
 */
export function getZoroastrianTotem(year, month, day) {
    // Если дата до 21 марта, то это еще предыдущий зороастрийский год
    let zYear = year;

    // Месяцы 1(янв) и 2(фев) - точно прошлый год.
    // Месяц 3(март) - если день < 21, то прошлый год.
    if (month < 3 || (month === 3 && day < 21)) {
        zYear = year - 1;
    }

    // Опорная точка: 1939 год - индекс 0 (Олень)
    const cycleStart = 1939;
    let delta = (zYear - cycleStart) % 32;

    if (delta < 0) {
        delta += 32;
    }

    return ZOROASTRIAN_TOTEMS[delta];
}


// ==========================================
// 3. ЗАПАДНЫЙ ЗОДИАК
// ==========================================

export function getZodiac(day, month) {
    const zodiac = [
        { char: 'Козерог', end: 19 },
        { char: 'Водолей', end: 18 },
        { char: 'Рыбы', end: 20 },
        { char: 'Овен', end: 19 },
        { char: 'Телец', end: 20 },
        { char: 'Близнецы', end: 20 },
        { char: 'Рак', end: 22 },
        { char: 'Лев', end: 22 },
        { char: 'Дева', end: 22 },
        { char: 'Весы', end: 22 },
        { char: 'Скорпион', end: 21 },
        { char: 'Стрелец', end: 21 },
        { char: 'Козерог', end: 31 }
    ];

    if (day > zodiac[month - 1].end) {
        return zodiac[month].char;
    } else {
        return zodiac[month - 1].char;
    }
}
